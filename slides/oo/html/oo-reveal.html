<!DOCTYPE html>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Ch.9: Object-oriented programming">

<title>Ch.9: Object-oriented programming</title>







<!-- reveal.js: http://lab.hakim.se/reveal-js/ -->

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
<!--
<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/beige.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/beigesmall.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/solarized.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/serif.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/moon.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/default.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/cbc.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/simula.css" id="theme">
-->

<!-- For syntax highlighting -->
<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

<!-- If the query includes 'print-pdf', use the PDF print sheet -->
<script>
document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
</script>

<style type="text/css">
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    p.caption { width: 80%; font-size: 60%; font-style: italic; text-align: left; }
    hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .reveal .alert-text-small   { font-size: 80%;  }
    .reveal .alert-text-large   { font-size: 130%; }
    .reveal .alert-text-normal  { font-size: 90%;  }
    .reveal .alert {
             padding:8px 35px 8px 14px; margin-bottom:18px;
             text-shadow:0 1px 0 rgba(255,255,255,0.5);
             border:5px solid #bababa;
             -webkit-border-radius: 14px; -moz-border-radius: 14px;
             border-radius:14px
             background-position: 10px 10px;
             background-repeat: no-repeat;
             background-size: 38px;
             padding-left: 30px; /* 55px; if icon */
     }
     .reveal .alert-block {padding-top:14px; padding-bottom:14px}
     .reveal .alert-block > p, .alert-block > ul {margin-bottom:1em}
     /*.reveal .alert li {margin-top: 1em}*/
     .reveal .alert-block p+p {margin-top:5px}
     /*.reveal .alert-notice { background-image: url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_notice.png); }
     .reveal .alert-summary  { background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_summary.png); }
     .reveal .alert-warning { background-image: url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_warning.png); }
     .reveal .alert-question {background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_question.png); } */

</style>



<!-- Styles for table layout of slides -->
<style type="text/css">
td.padding {
  padding-top:20px;
  padding-bottom:20px;
  padding-right:50px;
  padding-left:50px;
}
</style>

</head>

<body>
<div class="reveal">

<!-- Any section element inside the <div class="slides"> container
     is displayed as a slide -->

<div class="slides">





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    



<section>
<!-- ------------------- main content ---------------------- -->



<center><h1 style="text-align: center;">Ch.9: Object-oriented programming</h1></center>  <!-- document title -->

<p>
<!-- author(s): Hans Petter Langtangen -->

<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>

<p>&nbsp;<br>
<!-- institution(s) -->

<center>[1] <b>Simula Research Laboratory</b></center>
<center>[2] <b>University of Oslo, Dept. of Informatics</b></center>
<br>
<p>&nbsp;<br>
<center><h4>Aug 15, 2015</h4></center> <!-- date -->
<br>
</section>


<section>
<h1 id="___sec0">Inheritance </h1>

<p>

<table border="0">
<tr>
<td class="padding">
<center><p><img src="fig-oo/associations/class_inheritance1.jpg" align="bottom" width=500></p></center>
</td>
<td class="padding">
<center><p><img src="fig-oo/associations/class_inheritance3.png" align="bottom" width=500></p></center>
</td>
</tr>
</table>
</section>


<section>
<h2 id="___sec1">The chapter title <em>Object-oriented programming</em> (OO) may mean two different things </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ol>
<p><li> Programming with classes (better: object-<em>based</em> programming)</li>
<p><li> <font color="red">Programming with class hierarchies</font> (class families)</li>
</ol>
</div>
</section>


<section>
<!-- ===== New concept: collect classes in families (hierarchies) and let child classes inherit attributes and methods from parent classes ===== -->

<h2 id="___sec2">New concept: collect classes in families (hierarchies)  </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>What is a class hierarchy?</b>
<ul>

<p><li> A family of closely related classes</li>

<p><li> A key concept is <em>inheritance</em>: child classes can inherit attributes and methods from parent class(es) - this saves much typing and code duplication</li>
</ul>
<p>

As usual, we shall learn through examples!
</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
OO is a Norwegian invention by Ole-Johan Dahl and Kristen Nygaard in the 1960s - one of the most important inventions in computer science, because OO is used in all big computer systems today!
</div>
</section>


<section>
<h2 id="___sec3">Warning: OO is difficult and takes time to master </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li> Let ideas mature with time</li>

<p><li> Study many examples</li>

<p><li> OO is less important in Python than in C++, Java and C#, so the benefits of OO are less obvious in Python</li>

<p><li> Our examples here on OO employ numerical methods for \( \int_a^b f(x)dx \), \( f'(x) \), \( u'=f(u,t) \) - make sure you understand the simplest of these numerical methods before you study the combination of OO and numerics</li>

<p><li> Our goal: write general, reusable modules with lots of methods for numerical computing of \( \int_a^b f(x)dx \), \( f'(x) \), \( u'=f(u,t) \)</li>
</ul>
</div>
</section>


<section>
<h2 id="___sec4">A class for straight lines </h2>

<p>

<div class="fragment alert alert-block alert-block alert-text-normal">
<b>Problem:</b>
<p>
Make a class for evaluating lines \( y=c_0 + c_1x \).
</div>

<p>

<div class="fragment alert alert-block alert-block alert-text-normal">
<b>Code:</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="fragment" class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Line</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c0,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c0</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c1*x</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">table</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">L,</span> <span style="color: #d0d0d0">R,</span> <span style="color: #d0d0d0">n):</span>
        <span style="color: #ed9d13">&quot;&quot;&quot;Return a table with n points for L &lt;= x &lt;= R.&quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;&#39;</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">x</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">linspace(L,</span> <span style="color: #d0d0d0">R,</span> <span style="color: #d0d0d0">n):</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">(x)</span>
            <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">+=</span> <span style="color: #ed9d13">&#39;%12g %12g\n&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(x,</span> <span style="color: #d0d0d0">y)</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">s</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec5">A class for parabolas </h2>

<p>

<div class="fragment alert alert-block alert-block alert-text-normal">
<b>Problem:</b>
<p>
Make a class for evaluating parabolas \( y=c_0 + c_1x + c_2x^2 \).
</div>

<p>

<div class="fragment alert alert-block alert-block alert-text-normal">
<b>Code:</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="fragment" class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Parabola</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1,</span> <span style="color: #d0d0d0">c2):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c0,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c1,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1,</span> <span style="color: #d0d0d0">c2</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c2*x**</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c1*x</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c0</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">table</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">L,</span> <span style="color: #d0d0d0">R,</span> <span style="color: #d0d0d0">n):</span>
        <span style="color: #ed9d13">&quot;&quot;&quot;Return a table with n points for L &lt;= x &lt;= R.&quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;&#39;</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">x</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">linspace(L,</span> <span style="color: #d0d0d0">R,</span> <span style="color: #d0d0d0">n):</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">(x)</span>
            <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">+=</span> <span style="color: #ed9d13">&#39;%12g %12g\n&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(x,</span> <span style="color: #d0d0d0">y)</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">s</span>
</pre></div>

</div>

<p>

<div class="fragment alert alert-block alert-block alert-text-normal">
<b>Observation:</b>
<p>
This is almost the same code as class <code>Line</code>, except for the things with <code>c2</code>
</div>
</section>


<section>
<h2 id="___sec6">Class Parabola as a subclass of Line; principles </h2>

<p>

<div class="fragment alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li class="fragment"> <code>Parabola</code> code = <code>Line</code> code + a little extra with the \( c_2 \) term</li>

<p><li class="fragment"> Can we utilize class <code>Line</code> code in class <code>Parabola</code>?</li>

<p><li class="fragment"> This is what inheritance is about!</li>
</ul>
<p>

Writing

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="fragment" class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Parabola</span><span style="color: #d0d0d0">(Line):</span>
    <span style="color: #6ab825; font-weight: bold">pass</span>
</pre></div>
<p>
makes <code>Parabola</code> inherit all methods and attributes from <code>Line</code>, so <code>Parabola</code> has attributes <code>c0</code> and <code>c1</code> and three methods
</div>

<p>

<div class="fragment alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li class="fragment"> <code>Line</code> is a <em>superclass</em>, <code>Parabola</code> is a <em>subclass</em> <br />
    (parent class, base class; child class, derived class)</li>

<p><li class="fragment"> Class <code>Parabola</code> must add code to <code>Line</code>'s constructor (an extra <code>c2</code> attribute), <code>__call__</code> (an extra term), but <code>table</code> can be used unaltered</li>

<p><li class="fragment"> The principle is to reuse as much code in <code>Line</code> as possible and avoid duplicating code</li>
</ul>
</div>
</section>


<section>
<h2 id="___sec7">Class Parabola as a subclass of Line; code </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
A subclass method can call a superclass method in this way:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">superclass_name.method(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">arg1,</span> <span style="color: #d0d0d0">arg2,</span> <span style="color: #d0d0d0">...)</span>
</pre></div>
<p>
Class <code>Parabola</code> as a subclass of <code>Line</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Parabola</span><span style="color: #d0d0d0">(Line):</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1,</span> <span style="color: #d0d0d0">c2):</span>
        <span style="color: #d0d0d0">Line.__init__(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1)</span>  <span style="color: #999999; font-style: italic"># Line stores c0, c1</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">c2</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">Line.__call__(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x)</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c2*x**</span><span style="color: #3677a9">2</span>
</pre></div>
<p>
What is gained?

<ul>

<p><li class="fragment"> Class <code>Parabola</code> just adds code to the already existing code in class <code>Line</code> - no duplication of storing <code>c0</code> and <code>c1</code>, and computing \( c_0+c_1x \)</li>

<p><li class="fragment"> Class <code>Parabola</code> also has a <code>table</code> method - it is inherited</li>

<p><li class="fragment"> <code>__init__</code> and <code>__call__</code> are <em>overridden</em> or <em>redefined</em> in the subclass</li>
</ul>


</div>
</section>


<section>
<h2 id="___sec8">Class Parabola as a subclass of Line; demo </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Parabola(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">p1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">p(</span><span style="color: #3677a9">2.5</span><span style="color: #d0d0d0">)</span>
<span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">p1</span>
<span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">p.table(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">3</span><span style="color: #d0d0d0">)</span>
</pre></div>
<p>
Output:

<p>

<!-- code=text (!bc dat) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%">8.5
           0            1
         0.5          0.5
           1            1
</pre></div>

</div>
</section>


<section>

<p>
<!-- --- begin exercise --- -->

<h2 id="___sec9">Exercise 1: Point out the program flow </h2>

<p>

<iframe width="950" height="500" frameborder="0"
        src="http://pythontutor.com/iframe-embed.html#code=class+Line%3A%0A++++def+__init__%28self%2C+c0%2C+c1%29%3A%0A++++++++self.c0%2C+self.c1+%3D+c0%2C+c1%0A%0A++++def+__call__%28self%2C+x%29%3A%0A++++++++return+self.c0+%2B+self.c1%2Ax%0A%0A++++def+table%28self%2C+L%2C+R%2C+n%29%3A%0A++++++++%22%22%22Return+a+table+with+n+points+for+L+%3C%3D+x+%3C%3D+R.%22%22%22%0A++++++++s+%3D+%27%27%0A++++++++for+x+in+linspace%28L%2C+R%2C+n%29%3A%0A++++++++++++y+%3D+self%28x%29%0A++++++++++++s+%2B%3D+%27%2512g+%2512g%5Cn%27+%25+%28x%2C+y%29%0A++++++++return+s%0A%0Aclass+Parabola%28Line%29%3A%0A++++def+__init__%28self%2C+c0%2C+c1%2C+c2%29%3A%0A++++++++Line.__init__%28self%2C+c0%2C+c1%29++%23+Line+stores+c0%2C+c1%0A++++++++self.c2+%3D+c2%0A%0A++++def+__call__%28self%2C+x%29%3A%0A++++++++return+Line.__call__%28self%2C+x%29+%2B+self.c2%2Ax%2A%2A2%0A%0Ap+%3D+Parabola%281%2C+-2%2C+2%29%0Aprint+p%282.5%29&curInstr=0&py=2&cumulative=false">
</iframe>
<p>
<!-- --- end exercise --- -->
</section>


<section>
<h2 id="___sec10">We can check class type and class relations with <code>isinstance(obj, type)</code> and <code>issubclass(subclassname, superclassname)</code> </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<!-- code=python (!bc pyshell) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">Line_Parabola</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">Line,</span> <span style="color: #d0d0d0">Parabola</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">l</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Line(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #24909d">isinstance</span><span style="color: #d0d0d0">(l,</span> <span style="color: #d0d0d0">Line)</span>
<span style="color: #24909d">True</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #24909d">isinstance</span><span style="color: #d0d0d0">(l,</span> <span style="color: #d0d0d0">Parabola)</span>
<span style="color: #24909d">False</span>

<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Parabola(-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">10</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #24909d">isinstance</span><span style="color: #d0d0d0">(p,</span> <span style="color: #d0d0d0">Parabola)</span>
<span style="color: #24909d">True</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #24909d">isinstance</span><span style="color: #d0d0d0">(p,</span> <span style="color: #d0d0d0">Line)</span>
<span style="color: #24909d">True</span>

<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #24909d">issubclass</span><span style="color: #d0d0d0">(Parabola,</span> <span style="color: #d0d0d0">Line)</span>
<span style="color: #24909d">True</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #24909d">issubclass</span><span style="color: #d0d0d0">(Line,</span> <span style="color: #d0d0d0">Parabola)</span>
<span style="color: #24909d">False</span>

<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">p.__class__</span> <span style="color: #d0d0d0">==</span> <span style="color: #d0d0d0">Parabola</span>
<span style="color: #24909d">True</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">p.__class__.__name__</span>   <span style="color: #999999; font-style: italic"># string version of the class name</span>
<span style="color: #ed9d13">&#39;Parabola&#39;</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec11">Line as a subclass of Parabola </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>
 <p><li> Subclasses are often special cases of a superclass</li>
 <p><li> A line \( c_0+c_1x \) is a special case of a parabola \( c_0+c_1x+c_2x^2 \)</li>
 <p><li> Can <code>Line</code> be a subclass of <code>Parabola</code>?</li>
 <p><li> No problem - this is up to the programmer's choice</li>
 <p><li> Many will prefer this relation between a line and a parabola</li>
</ul>
</div>
</section>


<section>
<h2 id="___sec12">Code when Line is a subclass of Parabola </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Parabola</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1,</span> <span style="color: #d0d0d0">c2):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c0,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c1,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1,</span> <span style="color: #d0d0d0">c2</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c2*x**</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c1*x</span> <span style="color: #d0d0d0">+</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.c0</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">table</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">L,</span> <span style="color: #d0d0d0">R,</span> <span style="color: #d0d0d0">n):</span>
        <span style="color: #ed9d13">&quot;&quot;&quot;Return a table with n points for L &lt;= x &lt;= R.&quot;&quot;&quot;</span>
        <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;&#39;</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">x</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">linspace(L,</span> <span style="color: #d0d0d0">R,</span> <span style="color: #d0d0d0">n):</span>
            <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">(x)</span>
            <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">+=</span> <span style="color: #ed9d13">&#39;%12g %12g\n&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(x,</span> <span style="color: #d0d0d0">y)</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">s</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Line</span><span style="color: #d0d0d0">(Parabola):</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1):</span>
        <span style="color: #d0d0d0">Parabola.__init__(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">c0,</span> <span style="color: #d0d0d0">c1,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">)</span>
</pre></div>
<p>
Note: <code>__call__</code> and <code>table</code> can be reused in class <code>Line</code>!
</div>
</section>


<section>
<h2 id="___sec13">Recall the class for numerical differentiation from Ch. 7 </h2>

<p>&nbsp;<br>
$$ f'(x) \approx {f(x+h)-f(x)\over h} $$
<p>&nbsp;<br>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Derivative</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h=</span><span style="color: #3677a9">1E-5</span><span style="color: #d0d0d0">):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">f</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(h)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span>      <span style="color: #999999; font-style: italic"># make short forms</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">(f(x+h)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">f(x))/h</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">f</span><span style="color: #d0d0d0">(x):</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">exp(-x)*cos(tanh(x))</span>

<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">math</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">exp,</span> <span style="color: #d0d0d0">cos,</span> <span style="color: #d0d0d0">tanh</span>
<span style="color: #d0d0d0">dfdx</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Derivative(f)</span>
<span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">dfdx(</span><span style="color: #3677a9">2.0</span><span style="color: #d0d0d0">)</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec14">There are numerous formulas numerical differentiation </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>&nbsp;<br>
$$
\begin{align*}
f'(x) &= \frac{f(x+h)-f(x)}{h} + {\cal O}(h)\\
f'(x) &= \frac{f(x)-f(x-h)}{h} + {\cal O}(h)\\
f'(x) &= \frac{f(x+h)-f(x-h)}{2h} + {\cal O}(h^2)\\
f'(x) &=  \frac{4}{3}\frac{f(x+h)-f(x-h)}{2h}
  -\frac{1}{3}\frac{f(x+2h) - f(x-2h)}{4h} + {\cal O}(h^4)\\
f'(x) &=  \frac{3}{2}\frac{f(x+h)-f(x-h)}{2h}
  -\frac{3}{5}\frac{f(x+2h) - f(x-2h)}{4h} + \nonumber\\
&  \frac{1}{10}\frac{f(x+3h) - f(x-3h)}{6h} + {\cal O}(h^6)\\
f'(x) &=  \frac{1}{h}\left(
-\frac{1}{6}f(x+2h) + f(x+h) - \frac{1}{2}f(x) - \frac{1}{3}f(x-h)\right)
  + {\cal O}(h^3)
\end{align*}
$$
<p>&nbsp;<br>
</div>
</section>


<section>
<h2 id="___sec15">How can we make a module that offers all these formulas? </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>It's easy:</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Forward1</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h=</span><span style="color: #3677a9">1E-5</span><span style="color: #d0d0d0">):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">f</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(h)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">(f(x+h)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">f(x))/h</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Backward1</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h=</span><span style="color: #3677a9">1E-5</span><span style="color: #d0d0d0">):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">f</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(h)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">(f(x)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">f(x-h))/h</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Central2</span><span style="color: #d0d0d0">:</span>
    <span style="color: #999999; font-style: italic"># same constructor</span>
    <span style="color: #999999; font-style: italic"># put relevant formula in __call__</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec16">What is the problem with this type of code? </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
All the constructors are identical so we duplicate a lot of code.
</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>
 <p><li> A general OO idea: place code common to many classes in a superclass and inherit that code</li>
 <p><li> Here: inhert constructor from superclass,<br />
   let subclasses for different differentiation formulas implement
   their version of <code>__call__</code></li>
</ul>
</div>
</section>


<section>
<h2 id="___sec17">Class hierarchy for numerical differentiation </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Superclass:</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Diff</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h=</span><span style="color: #3677a9">1E-5</span><span style="color: #d0d0d0">):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">f</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(h)</span>
</pre></div>

</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Subclass for simple 1st-order forward formula:</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Forward1</span><span style="color: #d0d0d0">(Diff):</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">(f(x+h)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">f(x))/h</span>
</pre></div>

</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Subclass for 4-th order central formula:</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Central4</span><span style="color: #d0d0d0">(Diff):</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">4.</span><span style="color: #d0d0d0">/</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">)*(f(x+h)</span>   <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">f(x-h))</span>  <span style="color: #d0d0d0">/(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*h)</span> <span style="color: #d0d0d0">-</span> \
               <span style="color: #d0d0d0">(</span><span style="color: #3677a9">1.</span><span style="color: #d0d0d0">/</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">)*(f(x+</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*h)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">f(x-</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*h))/(</span><span style="color: #3677a9">4</span><span style="color: #d0d0d0">*h)</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec18">Use of the differentiation classes </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Interactive example: \( f(x)=\sin x \), compute \( f'(x) \) for \( x=\pi \)

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">Diff</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">math</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">sin</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">mycos</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Central4(sin)</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #999999; font-style: italic"># compute sin&#39;(pi):</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">mycos(pi)</span>
<span style="color: #d0d0d0">-</span><span style="color: #3677a9">1.000000082740371</span>
</pre></div>
<p>
<code>Central4(sin)</code> calls inherited constructor in superclass, while <code>mycos(pi)</code> calls <code>__call__</code> in the subclass <code>Central4</code>
</div>
</section>


<section>

<p>
<!-- --- begin exercise --- -->

<h2 id="___sec19">Exercise 2: Point out the program flow </h2>

<p>

<iframe width="950" height="500" frameborder="0"
        src="http://pythontutor.com/iframe-embed.html#code=class+Diff%3A%0A++++def+__init__%28self%2C+f%2C+h%3D1E-5%29%3A%0A++++++++self.f+%3D+f%0A++++++++self.h+%3D+float%28h%29%0A%0Aclass+Forward1%28Diff%29%3A%0A++++def+__call__%28self%2C+x%29%3A%0A++++++++f%2C+h+%3D+self.f%2C+self.h%0A++++++++return+%28f%28x%2Bh%29+-+f%28x%29%29%2Fh%0A%0Adfdx+%3D+Diff%28lambda+x%3A+x%2A%2A2%29%0Aprint+dfdx%280.5%29&curInstr=0&py=2&cumulative=false">
</iframe>
<p>
<!-- --- end exercise --- -->
</section>


<section>
<h2 id="___sec20">A flexible main program for numerical differentiation </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Suppose we want to differentiate function expressions from the command line:

<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%">Terminal&gt; python df.py &#39;exp(sin(x))&#39; Central 2 3.1
-1.04155573055

Terminal&gt; python df.py &#39;f(x)&#39; difftype difforder x
f&#39;(x)
</pre></div>
<p>
With <code>eval</code> and the <code>Diff</code> class hierarchy this main program can be realized in a few lines (many lines in C# and Java!):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">sys</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">Diff</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">math</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">scitools.StringFunction</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">StringFunction</span>

<span style="color: #d0d0d0">f</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">StringFunction(sys.argv[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
<span style="color: #d0d0d0">difftype</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sys.argv[</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">]</span>
<span style="color: #d0d0d0">difforder</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sys.argv[</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">]</span>
<span style="color: #d0d0d0">classname</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">difftype</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">difforder</span>
<span style="color: #d0d0d0">df</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">eval</span><span style="color: #d0d0d0">(classname</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39;(f)&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(sys.argv[</span><span style="color: #3677a9">4</span><span style="color: #d0d0d0">])</span>
<span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">df(x)</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec21">Investigating numerical approximation errors </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li> We can empirically investigate the accuracy of our family of 6 numerical differentiation formulas</li>

<p><li> Sample function: \( f(x)=\exp{(-10x)} \)</li>

<p><li> See the book for a little program that computes the errors:</li>
</ul>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">.</span>   <span style="color: #d0d0d0">h</span>        <span style="color: #d0d0d0">Forward1</span>        <span style="color: #d0d0d0">Central2</span>        <span style="color: #d0d0d0">Central4</span>
<span style="color: #3677a9">6.25E-02</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">2.56418286E+00</span>  <span style="color: #3677a9">6.63876231E-01</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">5.32825724E-02</span>
<span style="color: #3677a9">3.12E-02</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1.41170013E+00</span>  <span style="color: #3677a9">1.63556996E-01</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">3.21608292E-03</span>
<span style="color: #3677a9">1.56E-02</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">7.42100948E-01</span>  <span style="color: #3677a9">4.07398036E-02</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1.99260429E-04</span>
<span style="color: #3677a9">7.81E-03</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">3.80648092E-01</span>  <span style="color: #3677a9">1.01756309E-02</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1.24266603E-05</span>
<span style="color: #3677a9">3.91E-03</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">1.92794011E-01</span>  <span style="color: #3677a9">2.54332554E-03</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">7.76243120E-07</span>
<span style="color: #3677a9">1.95E-03</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">9.70235594E-02</span>  <span style="color: #3677a9">6.35795004E-04</span> <span style="color: #d0d0d0">-</span><span style="color: #3677a9">4.85085874E-08</span>
</pre></div>
<p>
Observations:

<ul>

<p><li> Halving \( h \) from row to row reduces the errors by a factor of 2, 4 and 16, i.e, the errors go like \( h \), \( h^2 \), and \( h^4 \)</li>

<p><li> <code>Central4</code> has really superior accuracy compared with <code>Forward1</code></li>
</ul>
</div>
</section>


<section>
<h2 id="___sec22">Alternative implementations (in the book) </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li> <em>Pure Python functions</em> <br />
    downside: more arguments to transfer, cannot apply formulas twice to get 2nd-order derivatives etc.</li>

<p><li> <em>Functional programming</em><br />
    gives the same flexibility as the OO solution</li>

<p><li> <em>One class and one common math formula</em> <br />
    applies math notation instead of programming techniques to generalize code</li>
</ul>
</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
These techniques are beyond scope in the course, but place OO into a bigger perspective. Might better clarify what OO is - for some.
</div>
</section>


<section>
<h2 id="___sec23">Formulas for numerical integration </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
There are numerous formulas for numerical integration and
all of them can be put into a common notation:

<p>&nbsp;<br>
$$ \int_a^b f(x)dx \approx \sum_{i=0}^{n-1} w_i f(x_i)$$
<p>&nbsp;<br>

\( w_i \): weights, \( x_i \): points (specific to a certain formula)
</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
The Trapezoidal rule has \( h=(b-a)/(n-1) \) and

<p>&nbsp;<br>
$$ x_i = a+ih, \quad w_0=w_{n-1}={h\over2},\ w_i=h\ (i\neq 0,n-1)$$
<p>&nbsp;<br>

<p>
The Midpoint rule has \( h=(b-a)/n \) and

<p>&nbsp;<br>
$$ x_i = a + {h\over 2} + ih,\quad w_i=h$$
<p>&nbsp;<br>
</div>
</section>


<section>
<h2 id="___sec24">More formulas </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Simpson's rule has

<p>&nbsp;<br>
$$
\begin{align*}
x_i &= a+ih,\quad h={b-a\over n-1}\\
w_0 &=w_{n-1}={h\over6}\\
w_i &= {h\over3}\hbox{ for }i\hbox{ even},\quad w_i={2h\over3}\hbox{ for }i\hbox{ odd}
\end{align*}
$$
<p>&nbsp;<br>

<p>
Other rules have more complicated formulas for \( w_i \) and \( x_i \)
</div>
</section>


<section>
<h2 id="___sec25">Why should these formulas be implemented in a class hierarchy? </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li class="fragment"> A numerical integration formula can be implemented as a class: \( a \), \( b \) and \( n \) are attributes and an <code>integrate</code> method evaluates the formula</li>

<p><li class="fragment"> All such classes are quite similar: the evaluation of \( \sum_jw_jf(x_j) \) is the same, only the definition of the points and weights differ among the classes</li>

<p><li class="fragment"> Recall: code duplication is a bad thing!</li>

<p><li class="fragment"> The general OO idea: place code common to many classes in a superclass and inherit that code</li>

<p><li class="fragment"> Here we put \( \sum_jw_jf(x_j) \) in a superclass (method <code>integrate</code>)</li>

<p><li class="fragment"> Subclasses extend the superclass with code specific to a math formula, i.e., \( w_i \) and \( x_i \) in a class method <code>construct_rule</code></li>
</ul>


</div>
</section>


<section>
<h2 id="___sec26">The superclass for integration </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Integrator</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">n):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.a,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.b,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.n</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">n</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.points,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.weights</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.construct_method()</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">construct_method</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">raise</span> <span style="color: #bbbbbb">NotImplementedError</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;no rule in class %s&#39;</span> <span style="color: #d0d0d0">%</span> \
                                  <span style="color: #24909d">self</span><span style="color: #d0d0d0">.__class__.__name__)</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">integrate</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">f):</span>
        <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.weights)):</span>
            <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">+=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.weights[i]*f(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.points[i])</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">s</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">vectorized_integrate</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">f):</span>
        <span style="color: #999999; font-style: italic"># f must be vectorized for this to work</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">dot(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.weights,</span> <span style="color: #d0d0d0">f(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.points))</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec27">A subclass: the Trapezoidal rule </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Trapezoidal</span><span style="color: #d0d0d0">(Integrator):</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">construct_method</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.b</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.a)/</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.n</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linspace(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.a,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.b,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.n)</span>
        <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">zeros(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(x))</span>
        <span style="color: #d0d0d0">w[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">:-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+=</span> <span style="color: #d0d0d0">h</span>
        <span style="color: #d0d0d0">w[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">;</span>  <span style="color: #d0d0d0">w[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">h/</span><span style="color: #3677a9">2</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">w</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec28">Another subclass: Simpson's rule </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li> Simpson's rule is more tricky to implement because of different formulas for odd and even points</li>

<p><li> Don't bother with the details of \( w_i \) and \( x_i \) in Simpson's rule now - focus on the class design!</li>
</ul>
</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Simpson</span><span style="color: #d0d0d0">(Integrator):</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">construct_method</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.n</span> <span style="color: #d0d0d0">%</span> <span style="color: #3677a9">2</span> <span style="color: #d0d0d0">!=</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">:</span>
            <span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #ed9d13">&#39;n=%d must be odd, 1 is added&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.n</span>
            <span style="color: #24909d">self</span><span style="color: #d0d0d0">.n</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>

        <span style="color: #d0d0d0">&lt;code</span> <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">computing</span> <span style="color: #d0d0d0">x</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">w&gt;</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">w</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec29">About the program flow </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Let us integrate \( \int_0^2 x^2dx \) using 101 points:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">f</span><span style="color: #d0d0d0">(x):</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x*x</span>

<span style="color: #d0d0d0">method</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Simpson(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">101</span><span style="color: #d0d0d0">)</span>
<span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">method.integrate(f)</span>
</pre></div>
<p>
Important:

<ul>

<p><li> <code>method = Simpson(...)</code>: this invokes the superclass constructor, which calls <code>construct_method</code> in class <code>Simpson</code></li>

<p><li> <code>method.integrate(f)</code> invokes the inherited <code>integrate</code> method, defined in class <code>Integrator</code></li>
</ul>
</div>
</section>


<section>

<p>
<!-- --- begin exercise --- -->

<h2 id="___sec30">Exercise 3: Point out the program flow </h2>

<p>

<iframe width="950" height="500" frameborder="0"
        src="http://pythontutor.com/iframe-embed.html#code=class+Integrator%3A%0A++++def+__init__%28self%2C+a%2C+b%2C+n%29%3A%0A++++++++self.a%2C+self.b%2C+self.n+%3D+a%2C+b%2C+n%0A++++++++self.points%2C+self.weights+%3D+self.construct_method%28%29%0A%0A++++def+construct_method%28self%29%3A%0A++++++++raise+NotImplementedError%28%27no+rule+in+class+%25s%27+%25+%5C%0A++++++++++++++++++++++++++++++++++self.__class__.__name__%29%0A%0A++++def+integrate%28self%2C+f%29%3A%0A++++++++s+%3D+0%0A++++++++for+i+in+range%28len%28self.weights%29%29%3A%0A++++++++++++s+%2B%3D+self.weights%5Bi%5D%2Af%28self.points%5Bi%5D%29%0A++++++++return+s%0A%0Aclass+Trapezoidal%28Integrator%29%3A%0A++++def+construct_method%28self%29%3A%0A++++++++h+%3D+%28self.b+-+self.a%29%2Ffloat%28self.n+-+1%29%0A++++++++x+%3D+linspace%28self.a%2C+self.b%2C+self.n%29%0A++++++++w+%3D+zeros%28len%28x%29%29%0A++++++++w%5B1%3A-1%5D+%2B%3D+h%0A++++++++w%5B0%5D+%3D+h%2F2%3B++w%5B-1%5D+%3D+h%2F2%0A++++++++return+x%2C+w%0A%0Adef+f%28x%29%3A%0A++++return+x%2Ax%0A%0Amethod+%3D+Trapezoidal%280%2C+2%2C+101%29%0Aprint+method.integrate%28f%29&curInstr=0&py=2&cumulative=false">
</iframe>
<p>
<!-- --- end exercise --- -->
</section>


<section>
<h2 id="___sec31">Applications of the family of integration classes </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
We can empirically test out the accuracy of different integration methods <code>Midpoint</code>, <code>Trapezoidal</code>, <code>Simpson</code>, <code>GaussLegendre2</code>, ... applied to, e.g.,

<p>&nbsp;<br>
$$ \int\limits_0^1 \left(1 + {1\over m}\right)t^{1\over m} dt= 1$$
<p>&nbsp;<br>
</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li> This integral is &quot;difficult&quot; numerically for \( m>1 \).</li>

<p><li> Key problem: the error in numerical integration formulas is of the form \( Cn^{-r} \), mathematical theory can predict \( r \) (the &quot;order&quot;), but we can estimate \( r \) empirically too</li>

<p><li> See the book for computational details</li>

<p><li> Here we focus on the conclusions</li>
</ul>
</div>
</section>


<section>
<h2 id="___sec32">Convergence rates for \( m < 1 \) (easy case) </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Simpson and Gauss-Legendre reduce the error faster than Midpoint and Trapezoidal (plot has ln(error) versus \( \ln n \))
</div>

<p>
<center><p><img src="fig-oo/power_int_m1.png" align="bottom" width=480></p></center>
</section>


<section>
<h2 id="___sec33">Convergence rates for \( m>1 \) (problematic case) </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
Simpson and Gauss-Legendre, which are theoretically &quot;smarter&quot; than Midpoint and Trapezoidal do not show superior behavior!
</div>

<p>
<center><p><img src="fig-oo/power_int_m2.png" align="bottom" width=480></p></center>
</section>


<section>
<h2 id="___sec34">Summary of object-orientation principles </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li> A subclass inherits everything from the superclass</li>

<p><li> When to use a subclass/superclass?</li>

<ul>

<p><li> if code common to several classes can be placed in a superclass</li>

<p><li> if the problem has a natural child-parent concept</li>
</ul>
<p><li> The program flow jumps between super- and sub-classes</li>

<p><li> It takes time to master <em>when</em> and <em>how</em> to use OO</li>

<p><li> Study examples!</li>
</ul>
</div>
</section>


<section>
<h2 id="___sec35">Recall the class hierarchy for differentiation </h2>

<p>
<div class="alert alert-block alert-block alert-text-small">
<b>Mathematical principles:</b>
<p>
 Collection of difference formulas for \( f'(x) \). For example,

<p>&nbsp;<br>
$$ f'(x) \approx {f(x+h)-f(x-h)\over 2h}$$
<p>&nbsp;<br>

<p>
Superclass <code>Diff</code> contains common code (constructor), subclasses implement various difference formulas.
</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Implementation example (superclass and one subclass).</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Diff</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h=</span><span style="color: #3677a9">1E-5</span><span style="color: #d0d0d0">):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">f</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(h)</span>

<span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Central2</span><span style="color: #d0d0d0">(Diff):</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__call__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">x):</span>
        <span style="color: #d0d0d0">f,</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.f,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.h</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">(f(x+h)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">f(x-h))/(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*h)</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec36">Recall the class hierarchy for integration (1) </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Mathematical principles:</b>
<p>
General integration formula for numerical integration:

<p>&nbsp;<br>
$$ \int_a^b f(x)dx \approx \sum_{j=0}^{n-1} w_if(x_i)$$
<p>&nbsp;<br>

<p>
Superclass <code>Integrator</code> contains common code (constructor, \( \sum_j w_if(x_i) \)), subclasses implement definition of \( w_i \) and \( x_i \).
</div>
</section>


<section>
<h2 id="___sec37">Recall the class hierarchy for integration (2) </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Implementation example (superclass and one subclass):</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"> <span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Integrator</span><span style="color: #d0d0d0">:</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">__init__</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">n):</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.a,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.b,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.n</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">n</span>
        <span style="color: #24909d">self</span><span style="color: #d0d0d0">.points,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.weights</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.construct_method()</span>

    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">integrate</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">f):</span>
        <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
        <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.weights)):</span>
            <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">+=</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.weights[i]*f(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.points[i])</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">s</span>

 <span style="color: #6ab825; font-weight: bold">class</span> <span style="color: #447fcf; text-decoration: underline">Trapezoidal</span><span style="color: #d0d0d0">(Integrator):</span>
    <span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">construct_method</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">):</span>
        <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linspace(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.a,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.b,</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.n)</span>
        <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.b</span> <span style="color: #d0d0d0">-</span> <span style="color: #24909d">self</span><span style="color: #d0d0d0">.a)/</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">self</span><span style="color: #d0d0d0">.n</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">zeros(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(x))</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">h</span>
        <span style="color: #d0d0d0">w[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">/=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">;</span>  <span style="color: #d0d0d0">w[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">/=</span> <span style="color: #3677a9">2</span>  <span style="color: #999999; font-style: italic"># adjust end weights</span>
        <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x,</span> <span style="color: #d0d0d0">w</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec38">A summarizing example: Generalized reading of input data </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Write a table of \( x\in [a,b] \) and \( f(x) \) to file:</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">outfile</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">open</span><span style="color: #d0d0d0">(filename,</span> <span style="color: #ed9d13">&#39;w&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">linspace</span>
<span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">x</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">linspace(a,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">n):</span>
    <span style="color: #d0d0d0">outfile.write(</span><span style="color: #ed9d13">&#39;%12g  %12g\n&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(x,</span> <span style="color: #d0d0d0">f(x)))</span>
<span style="color: #d0d0d0">outfile.close()</span>
</pre></div>

</div>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>We want flexible input:</b>
<p>
Read <code>a</code>, <code>b</code>, <code>n</code>, <code>filename</code> and a formula for <code>f</code> from...

<ul>

<p><li> the command line</li>

<p><li> interactive commands like <code>a=0</code>, <code>b=2</code>, <code>filename=mydat.dat</code></li>

<p><li> questions and answers in the terminal window</li>

<p><li> a graphical user interface</li>

<p><li> a file of the form</li>
</ul>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
<span style="color: #d0d0d0">b</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span>
<span style="color: #d0d0d0">filename</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">mydat.dat</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec39">Graphical user interface </h2>

<p>
<center><p><img src="fig-oo/ReadInputGUI.png" align="bottom" width=180></p></center>
</section>


<section>
<h2 id="___sec40">First we write the application code </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b>Desired usage:</b>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 110%; font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">ReadInput</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #999999; font-style: italic"># define all input parameters as name-value pairs in a dict:</span>
<span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">dict</span><span style="color: #d0d0d0">(formula=</span><span style="color: #ed9d13">&#39;x+1&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">a=</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">b=</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">n=</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">filename=</span><span style="color: #ed9d13">&#39;tmp.dat&#39;</span><span style="color: #d0d0d0">)</span>

<span style="color: #999999; font-style: italic"># read from some input medium:</span>
<span style="color: #d0d0d0">inp</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">ReadCommandLine(p)</span>
<span style="color: #999999; font-style: italic"># or</span>
<span style="color: #d0d0d0">inp</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">PromptUser(p)</span>     <span style="color: #999999; font-style: italic"># questions in the terminal window</span>
<span style="color: #999999; font-style: italic"># or</span>
<span style="color: #d0d0d0">inp</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">ReadInputFile(p)</span>  <span style="color: #999999; font-style: italic"># read file or interactive commands</span>
<span style="color: #999999; font-style: italic"># or</span>
<span style="color: #d0d0d0">inp</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">GUI(p)</span>            <span style="color: #999999; font-style: italic"># read from a GUI</span>

<span style="color: #999999; font-style: italic"># load input data into separate variables (alphabetic order)</span>
<span style="color: #d0d0d0">a,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">filename,</span> <span style="color: #d0d0d0">formula,</span> <span style="color: #d0d0d0">n</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">inp.get_all()</span>

<span style="color: #999999; font-style: italic"># go!</span>
</pre></div>

</div>
</section>


<section>
<h2 id="___sec41">About the implementation </h2>

<p>
<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<ul>

<p><li> A superclass <code>ReadInput</code> stores the dict and provides methods for getting input into program variables (<code>get</code>, <code>get_all</code>)</li>

<p><li> Subclasses read from different input sources</li>

<p><li> <code>ReadCommandLine</code>, <code>PromptUser</code>, <code>ReadInputFile</code>, <code>GUI</code></li>

<p><li> See the book or <code>ReadInput.py</code> for implementation details</li>

<p><li> For now the ideas and principles are more important than code details!</li>
</ul>
</div>
</section>



</div> <!-- class="slides" -->
</div> <!-- class="reveal" -->

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.min.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

    // Display navigation controls in the bottom right corner
    controls: true,

    // Display progress bar (below the horiz. slider)
    progress: true,

    // Display the page number of the current slide
    slideNumber: true,

    // Push each slide change to the browser history
    history: false,

    // Enable keyboard shortcuts for navigation
    keyboard: true,

    // Enable the slide overview mode
    overview: true,

    // Vertical centering of slides
    //center: true,
    center: false,

    // Enables touch navigation on devices with touch input
    touch: true,

    // Loop the presentation
    loop: false,

    // Change the presentation direction to be RTL
    rtl: false,

    // Turns fragments on and off globally
    fragments: true,

    // Flags if the presentation is running in an embedded mode,
    // i.e. contained within a limited portion of the screen
    embedded: false,

    // Number of milliseconds between automatically proceeding to the
    // next slide, disabled when set to 0, this value can be overwritten
    // by using a data-autoslide attribute on your slides
    autoSlide: 0,

    // Stop auto-sliding after user input
    autoSlideStoppable: true,

    // Enable slide navigation via mouse wheel
    mouseWheel: false,

    // Hides the address bar on mobile devices
    hideAddressBar: true,

    // Opens links in an iframe preview overlay
    previewLinks: false,

    // Transition style
    transition: 'default', // default/cube/page/concave/zoom/linear/fade/none

    // Transition speed
    transitionSpeed: 'default', // default/fast/slow

    // Transition style for full page slide backgrounds
    backgroundTransition: 'default', // default/none/slide/concave/convex/zoom

    // Number of slides away from the current that are visible
    viewDistance: 3,

    // Parallax background image
    //parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

    // Parallax background size
    //parallaxBackgroundSize: '' // CSS syntax, e.g. "2100px 900px"

    theme: Reveal.getQueryHash().theme, // available themes are in reveal.js/css/theme
    transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

});

Reveal.initialize({
    dependencies: [
        // Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
        { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },

        // Interpret Markdown in <section> elements
        { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },

        // Syntax highlight for <code> elements
        { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },

        // Zoom in and out with Alt+click
        { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },

        // Speaker notes
        { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },

        // Remote control your reveal.js presentation using a touch device
        //{ src: 'reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } },

        // MathJax
        //{ src: 'reveal.js/plugin/math/math.js', async: true }
    ]
});

Reveal.initialize({

    // The "normal" size of the presentation, aspect ratio will be preserved
    // when the presentation is scaled to fit different resolutions. Can be
    // specified using percentage units.
    width: 1170,  // original: 960,
    height: 700,

    // Factor of the display size that should remain empty around the content
    margin: 0.1,

    // Bounds for smallest/largest possible scale to apply to content
    minScale: 0.2,
    maxScale: 1.0

});
</script>

<!-- begin footer logo
<div style="position: absolute; bottom: 0px; left: 0; margin-left: 0px">
<img src="somelogo.png">
</div>
     end footer logo -->



</body>
</html>
